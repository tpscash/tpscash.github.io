<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="baidu-site-verification" content="1EB8XoOl0C"><meta name="google-site-verification" content="K7thEgdLm0UfRWJ5MGdF7sCcjClSzAlxFLPv2Oz5CGM"><title> RESTful-API · TPS Cash Team Blog</title><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="RESTful-API - Kevin"><meta name="keywords"><meta name="author" content="Kevin"><link rel="short icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/bubuzou.css"><link rel="search" type="application/opensearchdescription+xml" href="http://tpscash.github.io/atom.xml" title="TPS Cash Team Blog"></head><body><header><div class="header row"> <a href="/" class="logo-link"><img src="/images/logo.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" data-hover="POSTS" class="nav-list-link">POSTS</a></li><li class="nav-list-item"><a href="/archives/" target="_self" data-hover="ARCHIVES" class="nav-list-link">ARCHIVES</a></li></ul><div class="search"><a id="search_btn" href="#search"></a></div></div></header><div class="row scroll-con"><section class="container"><!-- for archive page--><div id="postAr" class="post"><article class="post-block"><h1 class="post-title">RESTful-API</h1><div class="post-info">2016-05-11<p class="visit"><i data-hk-page="current">- </i><span> Views</span></p></div><div class="post-content"><p>Here is an article to introduce what REST is all about.</p>
<a id="more"></a>
<h2 id="REST-Representational-State-Transfer"><a href="#REST-Representational-State-Transfer" class="headerlink" title="REST(Representational State Transfer)"></a>REST(Representational State Transfer)</h2><h3 id="Resources"><a href="#Resources" class="headerlink" title="Resources"></a>Resources</h3><p>“表现层”其实指的是”资源”（Resources）的”表现层”。 所谓”资源”，就是网络上的一个实体，或者说是网络上的一个具体信息。<br>它可以是一段文本、一张图片、一首歌曲、一种服务，总之就是一个具体的实在。你可以用一个URI（统一资源定位符）指向它，每种资源对应一个特定的URI。<br>要获取这个资源，访问它的URI就可以，因此URI就成了每一个资源的地址或独一无二的识别符。<br>应该在HTTP请求的头信息中用Accept和Content-Type字段指定，这两个字段才是对”表现层”的描述。</p>
<h3 id="Representation"><a href="#Representation" class="headerlink" title="Representation"></a>Representation</h3><p>互联网通信协议HTTP协议，是一个无状态协议。这意味着，所有的状态都保存在服务器端。因此，如果客户端想要操作服务器，必须通过某种手段，让服务器端发生”状态转化” (State Transfer)。<br>而这种转化是建立在表现层之上的，所以就是”表现层状态转化”。<br>客户端用到的手段，只能是HTTP协议。具体来说，就是HTTP协议里面，四个表示操作方式的动词：GET、POST、PUT、DELETE。<br>它们分别对应四种基本操作：GET用来获取资源，POST用来新建资源（也可以用于更新资源），PUT用来更新资源，DELETE用来删除资源。</p>
<table>
<thead>
<tr>
<th>No.</th>
<th>HTTP Method</th>
<th>URI Operation</th>
<th>Operation</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>GET</td>
<td>/UserService/users</td>
<td>Get list of users</td>
<td>Read Only</td>
</tr>
<tr>
<td>2</td>
<td>GET</td>
<td>/UserService/users/1</td>
<td>Get User with Id 1</td>
<td>Read Only</td>
</tr>
<tr>
<td>3</td>
<td>PUT</td>
<td>/UserService/users/2</td>
<td>Update User with Id 2</td>
<td>Idempotent</td>
</tr>
<tr>
<td>3</td>
<td>PATCH</td>
<td>/UserService/users/2</td>
<td>Update partial attribute of User with Id 2</td>
<td>Idempotent</td>
</tr>
<tr>
<td>4</td>
<td>POST</td>
<td>/UserService/users/2</td>
<td>Insert User with Id 2</td>
<td>N/A</td>
</tr>
<tr>
<td>5</td>
<td>DELETE</td>
<td>/UserService/users/1</td>
<td>Delete User with Id 1</td>
<td>Idempotent</td>
</tr>
</tbody>
</table>
<h3 id="Message"><a href="#Message" class="headerlink" title="Message"></a>Message</h3><p>RESTful web services make use of HTTP protocol as a medium of communication between client and server.<br>A client sends a message in form of a HTTP Request and server responds in form of a HTTP Response.<br>This technique is termed as Messaging. These messages contain message data and metadata i.e. information about message itself.<br>Let’s have a look on HTTP Request and HTTP Response messages for HTTP 1.1.</p>
<ul>
<li><p>HTTP Request</p>
<p>  A HTTP Request has five major parts:</p>
<p>  <img src="/images/posts/api/http_request.jpg" alt="request"></p>
<ul>
<li>Verb- Indicate HTTP methods such as GET, POST, DELETE, PUT etc.</li>
<li>URI- Uniform Resource Identifier (URI) to identify the resource on server</li>
<li>HTTP Version- Indicate HTTP version, for example HTTP v1.1 .</li>
<li>Request Header- Contains metadata for the HTTP Request message as key-value pairs. For example, client ( or browser) type, format supported by client, format of message body, cache settings etc.</li>
<li>Request Body- Message content or Resource representation.</li>
</ul>
</li>
</ul>
<ul>
<li><p>HTTP Response</p>
<p>  A HTTP Response has four major parts:</p>
<p>  <img src="/images/posts/api/http_response.jpg" alt="response"></p>
<ul>
<li>Status/Response Code - Indicate Server status for the requested resource. For example 404 means resource not found and 200 means response is ok.</li>
<li>HTTP Version - Indicate HTTP version, for example HTTP v1.1 .</li>
<li>Response Header - Contains metadata for the HTTP Response message as key-value pairs. For example, content length, content type, response date, server type etc.</li>
<li>Response Body - Response message content or Resource representation.</li>
</ul>
</li>
</ul>
<h3 id="Addressing"><a href="#Addressing" class="headerlink" title="Addressing"></a>Addressing</h3><p>Constructing a standard URI</p>
<p>Following are important points to be considered while designing a URI:</p>
<ul>
<li>Use Plural Noun - Use plural noun to define resources. For example, we’ve used users to identify users as a resource.</li>
<li>Avoid using spaces - Use underscore(_) or hyphen(-) when using a long resource name, for example, use authorized_users instead of authorized%20users.</li>
<li>Use lower-case letters - Although URI is case-insensitive, it is good practice to keep url in lower case letters only.</li>
<li>Maintain Backward Compatibility - As Web Service is a public service, a URI once made public should always be available. In case, URI gets updated, redirect the older URI to new URI using HTTP Status code, 300.</li>
<li>Use HTTP Verb - Always use HTTP Verb like GET, PUT, and DELETE to do the operations on the resource. It is not good to use operations names in URI.</li>
</ul>
<h3 id="Statelessness"><a href="#Statelessness" class="headerlink" title="Statelessness"></a>Statelessness</h3><p>As per REST architecture, a RESTful web service should not keep a client state on server.<br>This restriction is called statelessness. It is responsibility of the client to pass its context to server and then server can store this context to process client’s further request.<br>For example, session maintained by server is identified by session identifier passed by the client.</p>
<ul>
<li>Advantages of Statelessness</li>
<li>Web services can treat each method request independently.</li>
<li>Web services need not to maintain client’s previous interactions. It simplifies application design.</li>
<li>As HTTP is itself a statelessness protocol, RESTful Web services work seamlessly with HTTP protocol.</li>
<li>Disadvantages of Statelessness</li>
<li>Web services need to get extra information in each request and then interpret to get the client’s state in case client interactions are to be taken care of.</li>
</ul>
<h3 id="HTTP-Code"><a href="#HTTP-Code" class="headerlink" title="HTTP Code:"></a>HTTP Code:</h3><table>
<thead>
<tr>
<th>NO.</th>
<th>HTTP Code</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>200 OK</td>
<td>shows success.</td>
</tr>
<tr>
<td>2</td>
<td>201 CREATED</td>
<td>when a resource is successful created using POST or PUT request. Return link to newly created resource using location header.</td>
</tr>
<tr>
<td>3</td>
<td>204 NO CONTENT</td>
<td>when response body is empty for example, a DELETE request.</td>
</tr>
<tr>
<td>4</td>
<td>304 NOT MODIFIED</td>
<td>used to reduce network bandwidth usage in case of conditional GET requests. Response body should be empty. Headers should have date, location etc.</td>
</tr>
<tr>
<td>5</td>
<td>400 BAD REQUEST</td>
<td>states that invalid input is provided e.g. validation error, missing data.</td>
</tr>
<tr>
<td>6</td>
<td>401 UNAUTHORIZED</td>
<td>states that user is using invalid or wrong authentication token.</td>
</tr>
<tr>
<td>7</td>
<td>403 FORBIDDEN</td>
<td>states that user is not having access to method being used for example, delete access without admin rights.</td>
</tr>
<tr>
<td>8</td>
<td>404 NOT FOUND</td>
<td>states that method is not available.</td>
</tr>
<tr>
<td>9</td>
<td>409 CONFLICT</td>
<td>states conflict situation while executing the method for example, adding duplicate entry.</td>
</tr>
<tr>
<td>10</td>
<td>500 INTERNAL SERVER ERROR</td>
<td>states that server has thrown some exception while executing the method.</td>
</tr>
</tbody>
</table>
<h3 id="Cache"><a href="#Cache" class="headerlink" title="Cache:"></a>Cache:</h3><p>Caching refers to storing server response in client itself so that a client needs not to make server request for same resource again and again.<br>A server response should have information about how a caching is to be done so that a client caches response for a period of time or never caches the server response.</p>
<p>Following are the headers which a server response can have in order to configure a client’s caching:</p>
<table>
<thead>
<tr>
<th>NO.</th>
<th>Header</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Date</td>
<td>Date and Time of the resource when it was created.</td>
</tr>
<tr>
<td>2</td>
<td>Last Modified</td>
<td>Date and Time of the resource when it was last modified.</td>
</tr>
<tr>
<td>3</td>
<td>Cache-Control</td>
<td>Primary header to control caching.</td>
</tr>
<tr>
<td>4</td>
<td>Expires</td>
<td>Expiration date and time of caching.</td>
</tr>
<tr>
<td>5</td>
<td>Age</td>
<td>Duration in seconds from when resource was fetched from the server.</td>
</tr>
</tbody>
</table>
<p>当资源第一次被访问的时候，HTTP头部如下:</p>
<pre><code>(Request-Line)  GET /a.html HTTP/1.1
Host    127.0.0.1
User-Agent  Mozilla/5.0 (X11; U; Linux i686; zh-CN; rv:1.9.0.15) Gecko/2009102815 Ubuntu/9.04 (jaunty) Firefox/3.0.15
Accept              text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language     zh-cn,zh;q=0.5
Accept-Encoding     gzip,deflate
Accept-Charset      gb2312,utf-8;q=0.7,;q=0.7
Keep-Alive          300
Connection          keep-alive
</code></pre><p>HTTP返回头部如下</p>
<pre><code>(Status-Line)       HTTP/1.1 200 OK
Date                Thu, 26 Nov 2009 13:50:54 GMT
Server              Apache/2.2.11 (Unix) PHP/5.2.9
Last-Modified       Thu, 26 Nov 2009 13:50:19 GMT
Etag                “8fb8b-14-4794674acdcc0″
Accept-Ranges       bytes
Content-Length      20
Keep-Alive          timeout=5, max=100
Connection          Keep-Alive
Content-Type        text/html
</code></pre><p>当资源第一次被访问的时候，http返回200的状态码，并在头部携带上当前资源的一些描述信息，如</p>
<ul>
<li>Last-Modified      // 指示最后修改的时间</li>
<li>Etag                // 指示资源的状态唯一标识</li>
<li>Expires             // 指示资源在浏览器缓存中的过期时间</li>
</ul>
<p>接着浏览器会将文件缓存到Cache目录下，并同时保存文件的上述信息<br>当第二次请求该文件时，浏览器会先检查Cache目录下是否含有该文件，<br>如果有，并且还没到Expires设置的时间，即文件还没有过期，那么此时浏览器将直接从Cache目录中读取文件，而不再发送请求<br>如果文件此时已经过期，则浏览器会发送一次HTTP请求到WebServer，并在头部携带上当前文件的如下信息<br>If-Modified-Since   Thu, 26 Nov 2009 13:50:19 GMT<br>If-None-Match       ”8fb8b-14-4794674acdcc0″<br>即把上一次修改的时间，以及上一次请求返回的Etag值一起发送给服务器。<br>服务器在接收到这个请求的时候，先解析Header里头的信息，然后校验该头部信息。<br>如果该文件从上次时间到现在都没有过修改或者Etag信息没有变化，则服务端将直接返回一个304的状态，而不再返回文件资源，状态头部如下</p>
<pre><code>(Status-Line)       HTTP/1.1 304 Not Modified
Date                Thu, 26 Nov 2009 14:09:07 GMT
Server              Apache/2.2.11 (Unix) PHP/5.2.9
Connection          Keep-Alive
Keep-Alive          timeout=5, max=100
Etag                “8fb8b-14-4794674acdcc0″
</code></pre><h3 id="Security"><a href="#Security" class="headerlink" title="Security"></a>Security</h3><p>As RESTful web services work with HTTP URLs Paths so it is very important to safeguard a RESTful web service in the same manner as a website is be secured. Following are the best practices to be followed while designing a RESTful web service.</p>
<ul>
<li>Validation - Validate all inputs on the server. Protect your server against SQL or NoSQL injection attacks.</li>
<li>Session based authentication - Use session based authentication to authenticate a user whenever a request is made to a Web Service method.</li>
<li>No sensitive data in URL - Never use username, password or session token in URL , these values should be passed to Web Service via POST method.</li>
<li>Restriction on Method execution - Allow restricted use of methods like GET, POST, DELETE. GET method should not be able to delete data.</li>
<li>Validate Malformed XML/JSON - Check for well formed input passed to a web service method.</li>
<li>Throw generic Error Messages - A web service method should use HTTP error messages like 403 to show access forbidden etc.</li>
</ul>
<p>OAuth for API authentication</p>
<p>OAuth 2.0的运行流程如下图</p>
<p>  <img src="/images/posts/api/oauth_flow.png" alt="oauthFlow"></p>
<pre><code>（A）用户打开客户端以后，客户端要求用户给予授权。
（B）用户同意给予客户端授权。
（C）客户端使用上一步获得的授权，向认证服务器申请令牌。
（D）认证服务器对客户端进行认证以后，确认无误，同意发放令牌。
（E）客户端使用令牌，向资源服务器申请获取资源。
（F）资源服务器确认令牌无误，同意向客户端开放资源。
</code></pre><p>客户端必须得到用户的授权（authorization grant），才能获得令牌（access token）。<br>OAuth 2.0定义了四种授权方式。</p>
<ul>
<li>授权码模式（authorization code）</li>
<li>简化模式（implicit）</li>
<li>密码模式（resource owner password credentials）</li>
<li><p>客户端模式（client credentials）</p>
<p>授权码模式</p>
<p><img src="/images/posts/api/authorization_code.png" alt="authorizationCode"></p>
<p>步骤如下：</p>
<p>（A）用户访问客户端，后者将前者导向认证服务器。<br>（B）用户选择是否给予客户端授权。<br>（C）假设用户给予授权，认证服务器将用户导向客户端事先指定的”重定向URI”（redirection URI），同时附上一个授权码。<br>（D）客户端收到授权码，附上早先的”重定向URI”，向认证服务器申请令牌。这一步是在客户端的后台的服务器上完成的，对用户不可见。<br>（E）认证服务器核对了授权码和重定向URI，确认无误后，向客户端发送访问令牌（access token）和更新令牌（refresh token）。</p>
</li>
</ul>
<p>Introduction of OAuth2 : <a href="http://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html" target="_blank" rel="noopener">Oauth2</a><br>Wiki for all status: <a href="http://www.restapitutorial.com/httpstatuscodes.html" target="_blank" rel="noopener">HTTP STATUS CODE</a></p>
</div></article></div><div class="right-container"><div class="widget"><div class="category"><h4>Categories</h4><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/TED/">TED</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/framework/">framework</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/home/">home</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/life/">life</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/technologies/">technologies</a><span class="category-list-count">49</span></li></ul></div></div><div class="widget"><div class="tagcloud"><h4>Tag Cloud </h4><a href="/tags/Mac/" style="font-size: 12px;">Mac</a> <a href="/tags/TED/" style="font-size: 10px;">TED</a> <a href="/tags/Windows/" style="font-size: 10px;">Windows</a> <a href="/tags/annotation/" style="font-size: 10px;">annotation</a> <a href="/tags/api/" style="font-size: 10px;">api</a> <a href="/tags/centos/" style="font-size: 14px;">centos</a> <a href="/tags/cucumber/" style="font-size: 10px;">cucumber</a> <a href="/tags/curl/" style="font-size: 10px;">curl</a> <a href="/tags/database/" style="font-size: 12px;">database</a> <a href="/tags/design/" style="font-size: 10px;">design</a> <a href="/tags/docker/" style="font-size: 12px;">docker</a> <a href="/tags/git/" style="font-size: 18px;">git</a> <a href="/tags/home/" style="font-size: 10px;">home</a> <a href="/tags/java/" style="font-size: 10px;">java</a> <a href="/tags/jdk/" style="font-size: 14px;">jdk</a> <a href="/tags/jekyll/" style="font-size: 10px;">jekyll</a> <a href="/tags/json/" style="font-size: 10px;">json</a> <a href="/tags/jvm/" style="font-size: 10px;">jvm</a> <a href="/tags/life/" style="font-size: 14px;">life</a> <a href="/tags/linux/" style="font-size: 20px;">linux</a> <a href="/tags/lunr/" style="font-size: 10px;">lunr</a> <a href="/tags/mail/" style="font-size: 10px;">mail</a> <a href="/tags/markdown/" style="font-size: 10px;">markdown</a> <a href="/tags/maven/" style="font-size: 10px;">maven</a> <a href="/tags/mysql/" style="font-size: 12px;">mysql</a> <a href="/tags/network/" style="font-size: 10px;">network</a> <a href="/tags/nosql/" style="font-size: 10px;">nosql</a> <a href="/tags/oracle/" style="font-size: 12px;">oracle</a> <a href="/tags/outing/" style="font-size: 10px;">outing</a> <a href="/tags/principles/" style="font-size: 10px;">principles</a> <a href="/tags/project/" style="font-size: 10px;">project</a> <a href="/tags/recipe/" style="font-size: 10px;">recipe</a> <a href="/tags/regex/" style="font-size: 14px;">regex</a> <a href="/tags/restful/" style="font-size: 10px;">restful</a> <a href="/tags/sed/" style="font-size: 10px;">sed</a> <a href="/tags/servlet/" style="font-size: 10px;">servlet</a> <a href="/tags/shell/" style="font-size: 16px;">shell</a> <a href="/tags/sql/" style="font-size: 12px;">sql</a> <a href="/tags/ss/" style="font-size: 10px;">ss</a> <a href="/tags/ssh/" style="font-size: 10px;">ssh</a> <a href="/tags/ssl/" style="font-size: 10px;">ssl</a> <a href="/tags/string/" style="font-size: 10px;">string</a> <a href="/tags/thread/" style="font-size: 10px;">thread</a> <a href="/tags/wiremock/" style="font-size: 10px;">wiremock</a></div></div><div class="widget"><div class="recent"><h4>Recent Posts </h4><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/02/15/wiremock/">Wiremock - A fallback solution for existing API?</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/25/maven-docker-plugin/">Build Docker Image with Maven</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/23/shuangxi-outing/">Shuangxi Outing</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/29/ssl-handshake-failure-jdk8/">SSL Handshake Failure after Upgrading to JDK 8</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/29/check-connection-count/">Check DB Connection Count for Processes on Linux</a></li></ul></div></div><div class="widget"><div id="arAnchorBar"></div></div></div></section></div><div class="right-menu"></div><div class="modal search-modal"><div class="input-field"><input type="text" id="search_input"><label for="search-input">搜索</label></div><div id="search_result" class="search-result"></div></div><div class="blog-overlay"></div><footer class="row"><div class="footer-con"><div class="paginator"><a href="/2016/05/16/find-out-your-java-heap-size/" class="prev">PREV</a><a href="/2016/05/11/useful-sql/" class="next">NEXT</a></div><div id="disqus_thread"><script type="text/javascript">
var disqus_shortname = 'tpscash';
var disqus_identifier = '2016/05/11/restful-api/';
var disqus_title = 'RESTful-API';
var disqus_url = 'http://tpscash.github.io/2016/05/11/restful-api/';
(function() {
   var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
   dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">Blog comments powered by <span class="logo-disqus">Disqus</span></a></div><div class="copyright"><p>© 2016 - 2019 <a target="_blank">Kevin</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> <br> and <a href="https://github.com/Bulandent/hexo-theme-bubuzou" target="_blank">hexo-theme-bubuzou</a></p><p>闽ICP备16007301号-2</p></div><div class="totop"><i></i></div></div></footer><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script src="http://apps.bdimg.com/libs/jquery/1.8.2/jquery.min.js"></script><script src="https://cdn1.lncld.net/static/js/av-mini-0.6.10.js"></script><script src="/scripts/hit-kounter-lc-0.2.0.js"></script><script src="/scripts/arAnchor.js"></script><script src="/scripts/main.js"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>